<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Modern C++基础与实战 | B1ueDrops</title>
  <meta name="keywords" content="">
  <meta name="description" content="Modern C++基础与实战 | B1ueDrops">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="向阳而生, 喜欢聪明的人.">
<meta property="og:type" content="website">
<meta property="og:title" content="B1ueDrops">
<meta property="og:url" content="https://b1uedrops.github.io/about.html">
<meta property="og:site_name" content="B1ueDrops">
<meta property="og:description" content="向阳而生, 喜欢聪明的人.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-02-09T08:49:59.399Z">
<meta property="article:modified_time" content="2024-02-09T08:49:59.394Z">
<meta property="article:author" content="B1ueDrops">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpeg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.1.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpeg"/>
</a>
<div class="author">
    <span>B1ueDrops</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/B1ueDrops"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:bluedrops@yeah.net"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=2381446488&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(91)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="编程语言">
            
            编程语言
            <small>(10)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="操作系统">
            
            操作系统
            <small>(3)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="后端技术">
            
            后端技术
            <small>(19)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="金融知识">
            
            金融知识
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="开发工具">
            
            开发工具
            <small>(3)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="数学">
            
            数学
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="算法">
            
            算法
            <small>(24)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="体系结构">
            
            体系结构
            <small>(4)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="AI-HPC">
            
            AI-HPC
            <small>(12)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="English">
            
            English
            <small>(9)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">About</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="91">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All 开发工具 "
           href="/2024/12/08/infer_env/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="深度学习推理环境配置">深度学习推理环境配置</span>
            <span class="post-date" title="2024-12-08 14:27:18">2024/12/08</span>
        </a>
        
        
        <a  class="All 开发工具 "
           href="/2024/11/27/dev_env/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="快速配置基础的开发环境">快速配置基础的开发环境</span>
            <span class="post-date" title="2024-11-27 20:25:06">2024/11/27</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/11/25/ml/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="基础机器学习的一些内容">基础机器学习的一些内容</span>
            <span class="post-date" title="2024-11-25 16:02:38">2024/11/25</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/11/25/pytorch_quant/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AI模型量化的理论和实现">AI模型量化的理论和实现</span>
            <span class="post-date" title="2024-11-25 15:54:55">2024/11/25</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/11/25/pytorch_arch/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Pytorch的前后端架构">Pytorch的前后端架构</span>
            <span class="post-date" title="2024-11-25 15:54:48">2024/11/25</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/11/21/cuda_env/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CUDA理论和实战">CUDA理论和实战</span>
            <span class="post-date" title="2024-11-21 13:11:31">2024/11/21</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/11/09/valuable-algorithm/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="其他的算法题题解">其他的算法题题解</span>
            <span class="post-date" title="2024-11-09 18:21:12">2024/11/09</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/11/09/jianzhi_offer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="《剑指Offer》题解">《剑指Offer》题解</span>
            <span class="post-date" title="2024-11-09 18:17:29">2024/11/09</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/11/07/cpu_gemm/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="CPU后端上的GEMM优化">CPU后端上的GEMM优化</span>
            <span class="post-date" title="2024-11-07 14:16:48">2024/11/07</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/11/07/time_complexity/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="时间复杂度的一些知识">时间复杂度的一些知识</span>
            <span class="post-date" title="2024-11-07 12:12:58">2024/11/07</span>
        </a>
        
        
        <a  class="All 数学 "
           href="/2024/11/07/kalman/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="卡尔曼滤波数学推导">卡尔曼滤波数学推导</span>
            <span class="post-date" title="2024-11-07 12:08:35">2024/11/07</span>
        </a>
        
        
        <a  class="All 数学 "
           href="/2024/11/07/linear_algebra/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="线性代数">线性代数</span>
            <span class="post-date" title="2024-11-07 12:08:22">2024/11/07</span>
        </a>
        
        
        <a  class="All 数学 "
           href="/2024/11/07/quaternion/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="描述旋转的几种方式">描述旋转的几种方式</span>
            <span class="post-date" title="2024-11-07 12:08:01">2024/11/07</span>
        </a>
        
        
        <a  class="All 数学 "
           href="/2024/11/07/signal_process/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="信号与系统">信号与系统</span>
            <span class="post-date" title="2024-11-07 12:07:42">2024/11/07</span>
        </a>
        
        
        <a  class="All 数学 "
           href="/2024/11/07/probability/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="概率论与数理统计">概率论与数理统计</span>
            <span class="post-date" title="2024-11-07 12:07:18">2024/11/07</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/10/31/acwing_basic/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AcWing算法基础课题解">AcWing算法基础课题解</span>
            <span class="post-date" title="2024-10-31 20:05:59">2024/10/31</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/10/31/acwing_improve/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AcWing算法提高课题解">AcWing算法提高课题解</span>
            <span class="post-date" title="2024-10-31 19:36:46">2024/10/31</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/10/27/leetcode/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LeetCode-1000题题解">LeetCode-1000题题解</span>
            <span class="post-date" title="2024-10-27 11:06:02">2024/10/27</span>
        </a>
        
        
        <a  class="All 金融知识 "
           href="/2024/10/14/economics/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="资源与可持续发展">资源与可持续发展</span>
            <span class="post-date" title="2024-10-14 12:41:46">2024/10/14</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/22/x86_arch/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="x86-CPU的体系结构基础">x86-CPU的体系结构基础</span>
            <span class="post-date" title="2024-09-22 13:23:27">2024/09/22</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/20/program_time/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="理解程序运行的时间">理解程序运行的时间</span>
            <span class="post-date" title="2024-09-20 14:22:52">2024/09/20</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/17/transformer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Transformer的工作原理">Transformer的工作原理</span>
            <span class="post-date" title="2024-09-17 14:16:16">2024/09/17</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/17/roofline_model/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="性能分析的Roofline Model">性能分析的Roofline Model</span>
            <span class="post-date" title="2024-09-17 14:16:00">2024/09/17</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/17/ai_basic/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AI的基本模型和实现">AI的基本模型和实现</span>
            <span class="post-date" title="2024-09-17 14:14:52">2024/09/17</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/17/welford/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Welford算法计算方差">Welford算法计算方差</span>
            <span class="post-date" title="2024-09-17 14:14:12">2024/09/17</span>
        </a>
        
        
        <a  class="All AI-HPC "
           href="/2024/09/17/data-augmentation-metric/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="理解数据增广的本质">理解数据增广的本质</span>
            <span class="post-date" title="2024-09-17 14:14:03">2024/09/17</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/09/10/design_pattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="设计模式的实际操作">设计模式的实际操作</span>
            <span class="post-date" title="2024-09-10 18:29:51">2024/09/10</span>
        </a>
        
        
        <a  class="All 开发工具 "
           href="/2024/09/08/cpp_env/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="C语言系列环境工作区配置">C语言系列环境工作区配置</span>
            <span class="post-date" title="2024-09-08 13:53:44">2024/09/08</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/09/06/network_application_layer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="计算机网络-应用层">计算机网络-应用层</span>
            <span class="post-date" title="2024-09-06 14:31:30">2024/09/06</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/09/06/network_tcp/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="计算机网络-传输层">计算机网络-传输层</span>
            <span class="post-date" title="2024-09-06 14:31:18">2024/09/06</span>
        </a>
        
        
        <a  class="All 操作系统 "
           href="/2024/08/16/concurrent_sketch/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="并发编程的概述">并发编程的概述</span>
            <span class="post-date" title="2024-08-16 13:48:22">2024/08/16</span>
        </a>
        
        
        <a  class="All 操作系统 "
           href="/2024/08/16/multithread/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="多进程/多线程编程模型">多进程/多线程编程模型</span>
            <span class="post-date" title="2024-08-16 13:48:12">2024/08/16</span>
        </a>
        
        
        <a  class="All 操作系统 "
           href="/2024/08/16/linux_process/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Linux上的进程控制">Linux上的进程控制</span>
            <span class="post-date" title="2024-08-16 13:48:03">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/network_network_layer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="计算机网络-网络层">计算机网络-网络层</span>
            <span class="post-date" title="2024-08-16 13:46:58">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/network_datalink_layer/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="计算机网络-数据链路层">计算机网络-数据链路层</span>
            <span class="post-date" title="2024-08-16 13:46:50">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/tcp_stick/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="如何解决TCP粘包问题">如何解决TCP粘包问题</span>
            <span class="post-date" title="2024-08-16 13:46:38">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/build_design_pattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="创建型的设计模式">创建型的设计模式</span>
            <span class="post-date" title="2024-08-16 13:35:12">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/behaviour_design_pattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="行为型的设计模式">行为型的设计模式</span>
            <span class="post-date" title="2024-08-16 13:35:00">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/combine_design_pattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="组合型的设计模式">组合型的设计模式</span>
            <span class="post-date" title="2024-08-16 13:33:52">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/dns/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="DNS-客户端连接到机房的技术">DNS-客户端连接到机房的技术</span>
            <span class="post-date" title="2024-08-16 13:33:38">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/lvs_nginx/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LVS/Nginx-服务器调度的技术">LVS/Nginx-服务器调度的技术</span>
            <span class="post-date" title="2024-08-16 13:33:27">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/service_discovery/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="服务发现架构设计">服务发现架构设计</span>
            <span class="post-date" title="2024-08-16 13:33:15">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/storage_rpc/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="存储微服务的架构">存储微服务的架构</span>
            <span class="post-date" title="2024-08-16 13:33:00">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/mq/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="消息中间件技术">消息中间件技术</span>
            <span class="post-date" title="2024-08-16 13:32:10">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/16/concurrent_arch/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="高并发架构通用设计">高并发架构通用设计</span>
            <span class="post-date" title="2024-08-16 13:31:33">2024/08/16</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/08/10/data_replication_center/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="机房高可用技术">机房高可用技术</span>
            <span class="post-date" title="2024-08-10 20:04:18">2024/08/10</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/07/05/parser/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="编译原理-Parser的知识合集">编译原理-Parser的知识合集</span>
            <span class="post-date" title="2024-07-05 16:29:19">2024/07/05</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/07/04/raii/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="资源管理中RAII的概念">资源管理中RAII的概念</span>
            <span class="post-date" title="2024-07-04 16:16:39">2024/07/04</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/07/04/char_encode/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="字符集与字符编码的深度理解">字符集与字符编码的深度理解</span>
            <span class="post-date" title="2024-07-04 11:32:31">2024/07/04</span>
        </a>
        
        
        <a  class="All 体系结构 "
           href="/2024/07/04/ieee_754/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="体系结构中的浮点数">体系结构中的浮点数</span>
            <span class="post-date" title="2024-07-04 11:24:35">2024/07/04</span>
        </a>
        
        
        <a  class="All 金融知识 "
           href="/2024/05/22/quant_analysis/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="金融量化分析模型">金融量化分析模型</span>
            <span class="post-date" title="2024-05-22 18:08:38">2024/05/22</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/05/17/car-english/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="汽车英语">汽车英语</span>
            <span class="post-date" title="2024-05-17 13:37:34">2024/05/17</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/05/14/regular_expression/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="正则表达式原理和实战">正则表达式原理和实战</span>
            <span class="post-date" title="2024-05-14 20:14:59">2024/05/14</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/05/13/restaurant_english/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="饭店英语">饭店英语</span>
            <span class="post-date" title="2024-05-13 20:25:52">2024/05/13</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/05/12/frontend-lang/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="使用Vue快速搭建网站原型">使用Vue快速搭建网站原型</span>
            <span class="post-date" title="2024-05-12 21:13:45">2024/05/12</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/05/12/hotel-english/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="酒店英语">酒店英语</span>
            <span class="post-date" title="2024-05-12 12:29:02">2024/05/12</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/05/10/airport-english/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="机场英语">机场英语</span>
            <span class="post-date" title="2024-05-10 10:12:57">2024/05/10</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/05/09/practical-go/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Go语言原理与实战">Go语言原理与实战</span>
            <span class="post-date" title="2024-05-09 20:48:25">2024/05/09</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/05/09/database-basic/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="PostgreSQL数据库教程">PostgreSQL数据库教程</span>
            <span class="post-date" title="2024-05-09 20:24:37">2024/05/09</span>
        </a>
        
        
        <a  class="All 体系结构 "
           href="/2024/05/09/cache-basic/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Cache的基础知识与设计策略">Cache的基础知识与设计策略</span>
            <span class="post-date" title="2024-05-09 20:12:19">2024/05/09</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/04/13/practical-rust/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Rust原理与实战">Rust原理与实战</span>
            <span class="post-date" title="2024-04-13 17:05:26">2024/04/13</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/04/07/python_many/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Python原理与实战">Python原理与实战</span>
            <span class="post-date" title="2024-04-07 10:46:59">2024/04/07</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/30/binary-tree/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="二叉树系列">二叉树系列</span>
            <span class="post-date" title="2024-03-30 17:07:34">2024/03/30</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/24/data-struct/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="数据结构系列">数据结构系列</span>
            <span class="post-date" title="2024-03-24 14:10:22">2024/03/24</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/03/22/shell_script/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Shell脚本基础与实战">Shell脚本基础与实战</span>
            <span class="post-date" title="2024-03-22 12:50:32">2024/03/22</span>
        </a>
        
        
        <a  class="All 编程语言 "
           href="/2024/03/22/modern_cpp/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Modern C++基础与实战">Modern C++基础与实战</span>
            <span class="post-date" title="2024-03-22 11:31:11">2024/03/22</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/20/linear-dp/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="线性DP">线性DP</span>
            <span class="post-date" title="2024-03-20 18:11:22">2024/03/20</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/20/tree-dp/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="树形DP">树形DP</span>
            <span class="post-date" title="2024-03-20 18:10:56">2024/03/20</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/03/20/sci-writing-method/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="英语科技论文写作模型-Methodology">英语科技论文写作模型-Methodology</span>
            <span class="post-date" title="2024-03-20 16:53:17">2024/03/20</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/03/20/sci-writing-abstract/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="英语科技论文写作模型-Abstract">英语科技论文写作模型-Abstract</span>
            <span class="post-date" title="2024-03-20 16:49:54">2024/03/20</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/03/20/sci-writing-conclusion/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="英语科技论文写作模型-Conclusion">英语科技论文写作模型-Conclusion</span>
            <span class="post-date" title="2024-03-20 16:49:46">2024/03/20</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/03/20/sci-writing-results/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="英语科技论文写作模型-Results">英语科技论文写作模型-Results</span>
            <span class="post-date" title="2024-03-20 16:49:31">2024/03/20</span>
        </a>
        
        
        <a  class="All English "
           href="/2024/03/19/sci-writing-introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="英语科技论文写作模型-Introduction">英语科技论文写作模型-Introduction</span>
            <span class="post-date" title="2024-03-19 10:16:07">2024/03/19</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/10/catalan/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="卡特兰数系列">卡特兰数系列</span>
            <span class="post-date" title="2024-03-10 12:47:19">2024/03/10</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/03/knapsack/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="背包问题">背包问题</span>
            <span class="post-date" title="2024-03-03 16:22:21">2024/03/03</span>
        </a>
        
        
        <a  class="All 体系结构 "
           href="/2024/03/02/virtualmem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="虚拟内存的基础知识和设计">虚拟内存的基础知识和设计</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/sim-plus/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="高精度加减乘除">高精度加减乘除</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/prefix-sum-diff/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="前缀和/差分">前缀和/差分</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/parathesis/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="括号序列">括号序列</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/other-algorithm/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="其他算法/模拟题">其他算法/模拟题</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/mathematic/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="数学问题">数学问题</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/interval/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="区间问题">区间问题</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/graph/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="图论">图论</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/greedy/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="贪心算法">贪心算法</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/dfs/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="深度优先搜索">深度优先搜索</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 体系结构 "
           href="/2024/03/02/cache-coherence/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="缓存一致性">缓存一致性</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/catch-rain/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="接雨水问题">接雨水问题</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/bfs/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="广度优先搜索">广度优先搜索</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 算法 "
           href="/2024/03/02/binary-search/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="二分系列">二分系列</span>
            <span class="post-date" title="2024-03-02 19:59:34">2024/03/02</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/03/01/clean_code/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="代码整洁之道">代码整洁之道</span>
            <span class="post-date" title="2024-03-01 14:30:08">2024/03/01</span>
        </a>
        
        
        <a  class="All 后端技术 "
           href="/2024/03/01/software_rule/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="面向对象设计的基本原则">面向对象设计的基本原则</span>
            <span class="post-date" title="2024-03-01 14:30:02">2024/03/01</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-modern_cpp" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Modern C++基础与实战</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="编程语言">编程语言</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-09-17 19:23:08'>2024-03-22 11:31</time>
        
    </div>
    <div class="article-meta">
        
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E6%95%B0"><span class="toc-text">整数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-text">引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%BC%95%E7%94%A8"><span class="toc-text">不可变引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-text">常见问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="toc-text">函数重载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-text">动态内存管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">new和delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-1"><span class="toc-text">常见问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA"><span class="toc-text">内存分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%A4%9A%E6%96%87%E4%BB%B6%E7%BC%96%E7%A8%8B"><span class="toc-text">链接与多文件编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E8%AF%AD%E8%A8%80%E7%A8%8B%E5%BA%8F%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84"><span class="toc-text">C语言程序是如何执行的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%99%A8%E7%9A%84%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90"><span class="toc-text">链接器的符号解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%BC%BA%E5%BC%B1"><span class="toc-text">符号的强弱</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90%E7%AE%97%E6%B3%95"><span class="toc-text">符号解析算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5"><span class="toc-text">静态链接和动态链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E3%80%81%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9D%80%E3%80%81%E8%BF%90%E8%A1%8C%E5%9C%B0%E5%9D%80"><span class="toc-text">链接地址、加载地址、运行地址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%9C%B0%E5%9D%80%E4%B8%8D%E4%B8%80%E6%A0%B7"><span class="toc-text">链接地址和加载地址不一样</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%E5%92%8C%E8%BF%90%E8%A1%8C%E5%9C%B0%E5%9D%80%E4%B8%8D%E7%9B%B8%E5%90%8C"><span class="toc-text">链接地址和运行地址不相同</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BA%E4%BB%B6%E7%A8%8B%E5%BA%8F%E7%9A%84%E9%87%8D%E5%AE%9A%E4%BD%8D%E5%92%8C%E5%86%85%E6%A0%B8%E9%87%8D%E5%AE%9A%E4%BD%8D"><span class="toc-text">固件程序的重定位和内核重定位</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%E9%87%8D%E5%AE%9A%E4%BD%8D%E4%B8%8E%E6%9D%BE%E5%BC%9B%E4%BC%98%E5%8C%96"><span class="toc-text">链接重定位与松弛优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%BE%E5%BC%9B%E4%BC%98%E5%8C%96"><span class="toc-text">松弛优化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E6%9D%BE%E5%BC%9B%E4%BC%98%E5%8C%96"><span class="toc-text">对函数调用的松弛优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9D%BE%E5%BC%9B%E4%BC%98%E5%8C%96"><span class="toc-text">对全局符号索引的松弛优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gcc%E4%B8%AD%E7%9A%84%E6%9D%BE%E5%BC%9B%E4%BC%98%E5%8C%96"><span class="toc-text">gcc中的松弛优化</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">inline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">struct</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">class</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%91%98%E6%9D%83%E9%99%90"><span class="toc-text">成员权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-text">explicit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-text">析构函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="toc-text">运算符重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-text">继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-text">虚函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-2"><span class="toc-text">常见问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-text">模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAII"><span class="toc-text">RAII</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-text">智能指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-3"><span class="toc-text">常见问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STL"><span class="toc-text">STL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">Vector</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A6%E5%80%BC%E4%B8%8E%E5%8F%B3%E5%80%BC"><span class="toc-text">左值与右值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A6%E5%80%BC-%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8"><span class="toc-text">左值&#x2F;右值引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">移动构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%8A%98%E5%8F%A0-%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8-%E5%AE%8C%E7%BE%8E%E8%BD%AC%E5%8F%91"><span class="toc-text">引用折叠&#x2F;万能引用&#x2F;完美转发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">CMake</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">compile_commands</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2>
<h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3>
<ul>
<li><code>size_t</code>: 和体系结构相关的<strong>无符号整数</strong>.
<ul>
<li>在32位系统上, 可能是32位, 也可能是64位.</li>
<li>在64位系统上, 一定是64位.</li>
</ul>
</li>
<li><code>ssize_t</code>: 是<code>size_t</code>的有符号整数版本.</li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2>
<ul>
<li>
<p>引用就相当于对原始变量所有权的租借, 对引用的操作等价于对原变量的操作:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> num = <span class="hljs-number">0</span>;<br><span class="hljs-comment">// 取num引用</span><br><span class="hljs-type">int</span> &amp;b = num;<br><br><span class="hljs-function">Student <span class="hljs-title">s</span><span class="hljs-params">(string(<span class="hljs-string">&quot;haha&quot;</span>), <span class="hljs-number">1</span>)</span></span>;<br>Student &amp;stu = s;<br><span class="hljs-comment">// 操作引用操作变量和操作原变量接口相同</span><br>cout &lt;&lt; s.<span class="hljs-built_in">print</span>() &lt;&lt; endl;<br></code></pre></td></tr></table></figure>
<ul>
<li><font color="red"><strong>引用变量必须初始化 ! 编译器会在编译层面保证这一点.</strong></font></li>
</ul>
</li>
</ul>
<h3 id="不可变引用"><a href="#不可变引用" class="headerlink" title="不可变引用"></a>不可变引用</h3>
<ul>
<li>
<p>借助<code>const</code>可以实现不可变引用.</p>
</li>
<li>
<p>不可变引用: <code>const Type &amp;</code>.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 获取变量不可变引用</span><br><span class="hljs-type">int</span> num = <span class="hljs-number">0</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;b = num;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>可变引用: <code>Type &amp;</code>.</p>
</li>
</ul>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3>
<blockquote>
<p>引用和指针的区别?</p>
</blockquote>
<ul>
<li>指针, 本质上是一种所有权的量化, 它代表所有权本身, 这个所有权会由一个变量承载.</li>
<li>引用, 本质上是对所有权的租借, 它可以让多个变量承载同一个所有权.</li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2>
<h3 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h3>
<ul>
<li>
<p>注意: 重载是C++的特性, 而不是C语言的特性.</p>
</li>
<li>
<p>函数重载:</p>
<ul>
<li>可以同时定义多个重名函数, 这些函数参数, 返回值类型可以不同.</li>
<li>具体执行哪个函数是在编译时完成.</li>
</ul>
</li>
</ul>
<h2 id="动态内存管理"><a href="#动态内存管理" class="headerlink" title="动态内存管理"></a>动态内存管理</h2>
<h3><code>new</code>和<code>delete</code></h3>
<ul>
<li><code>delete</code>:
<ul>
<li>如果<code>new</code>的时候是<code>Student *a = new Student();</code>, 那么就用<code>delete a;</code></li>
<li>如果<code>new</code>的时候是<code>Student *stus = new Student()[];</code>, 那么就用<code>delete [] a;</code></li>
</ul>
</li>
</ul>
<h3 id="常见问题-1"><a href="#常见问题-1" class="headerlink" title="常见问题"></a>常见问题</h3>
<blockquote>
<p><code>malloc</code>和<code>new</code>的区别?</p>
</blockquote>
<ul>
<li>
<p><code>malloc</code>是C++标准库函数, <code>new</code>是C++的一个运算符.</p>
</li>
<li>
<p><code>malloc</code>需要手动计算内存大小, <code>new</code>可以自动计算.</p>
</li>
<li>
<p><code>malloc</code>返回<code>void *</code>类型的指针, 而<code>new</code>返回具体类型的指针.</p>
</li>
<li>
<p><code>malloc</code>不是类型安全的, 而<code>new</code>是类型安全的.</p>
<ul>
<li>假设你申请了一大块内存, 但是赋给了一个小变量(例如<code>int</code>类型), <code>new</code>会在编译时期报错, 而<code>malloc</code>不会.</li>
</ul>
</li>
<li>
<p><code>new</code>由 <code>malloc</code>, 指针转换, 构造函数三部分组成.</p>
</li>
</ul>
<blockquote>
<p><code>malloc</code>申请的内存可以用<code>delete</code>释放吗? <code>new</code>申请的内存可以用<code>free</code>释放吗?</p>
</blockquote>
<ul>
<li>都不可以, 核心在于:
<ul>
<li><code>malloc</code>不会调用构造函数, 而<code>new</code>会调用构造函数.
<ul>
<li>如果类的构造函数中有动态申请内存, 那么就会出现问题.</li>
</ul>
</li>
<li><code>free</code>不会调用析构函数, 而<code>delete</code>会调用析构函数.
<ul>
<li>如果类的析构函数中有释放成员变量占用的内存, 那么就会出现内存泄漏.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="内存分区"><a href="#内存分区" class="headerlink" title="内存分区"></a>内存分区</h2>
<ul>
<li>由低地址向高地址为:
<ul>
<li><code>.text</code>: 代码段.</li>
<li><code>.data</code>: 初始化的全局变量与静态变量.</li>
<li><code>.bss</code>: 全称为Block Started by Symbol, 包括未初始化的全局变量和静态变量.</li>
<li><code>heap</code>: 由低向高延伸, 存储动态申请的内存.</li>
<li><code>stack</code>: 由高向低延伸, 存储函数参数, 局部变量等栈帧信息.</li>
</ul>
</li>
</ul>
<blockquote>
<p>栈和堆的区别 (几个重要的点)?</p>
</blockquote>
<ul>
<li>栈是固定大小, 连续的内存区域 (不会产生碎片), 在CPU级别会提供栈的操作指令及相关寄存器. 栈由编译器进行管理.</li>
<li>堆是不固定大小, 不连续的内存区域 (OS链表管理, 会产生碎片), 堆的操作需要C++标准库提供, 堆由程序员管理.</li>
</ul>
<h2 id="链接与多文件编程"><a href="#链接与多文件编程" class="headerlink" title="链接与多文件编程"></a>链接与多文件编程</h2>
<h3 id="C语言程序是如何执行的"><a href="#C语言程序是如何执行的" class="headerlink" title="C语言程序是如何执行的"></a>C语言程序是如何执行的</h3>
<ul>
<li>
<p>第一步: 预处理, 对C语言各种预处理命令进行处理</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">gcc -E test.c -o test.i<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>第二步: 编译, 将C语言程序转换为对应的汇编语言</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">gcc -S test.i -o test.s<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>第三步: 汇编, 将汇编语言转换成可重定位目标文件, 可重定位目标文件有很多段</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">as test.s -o test.o<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>第四步: 链接, 链接有三个任务:</p>
<ul>
<li>符号解析, 把每个符号的引用和定义关联起来.</li>
<li>合并段: 把可重定位目标文件的段合并</li>
<li>重定位: 可重定位目标文件的每个符号的起始地址都从<code>0x0</code>开始, 但是生成的可执行目标文件需要按照OS的要求把每个段摆放到对应的地址.</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># -lc是链接到libc.a</span><br>ld -o <span class="hljs-built_in">test</span> test.o -lc<br></code></pre></td></tr></table></figure>
<h3 id="链接器的符号解析"><a href="#链接器的符号解析" class="headerlink" title="链接器的符号解析"></a>链接器的符号解析</h3>
<p>在C语言中, 符号分为三种类型:</p>
<ul>
<li>全局符号: 包括没有<code>static</code>的函数名, 以及没有<code>static</code>的全局变量.</li>
<li>外部符号: 用<code>extern</code>引用的外部的函数名/变量.</li>
<li>本地符号: 用<code>static</code>修饰的函数名和全局变量.</li>
</ul>
<h4 id="符号的强弱"><a href="#符号的强弱" class="headerlink" title="符号的强弱"></a>符号的强弱</h4>
<ul>
<li>强符号: 函数/已初始化的全局变量.</li>
<li>弱符号: 没有初始化的全局变量.</li>
<li>本地符号没有强弱之分.</li>
</ul>
<p>链接器根据强符号/弱符号规则来处理不同模块间多重符号的定义:</p>
<ul>
<li>强符号不能多次定义, 否则报错.</li>
<li>如果一个符号同时按照强符号和弱符号定义, 那么强符号为准.</li>
<li>如果只有多个弱符号定义, 那么随便选一个.</li>
</ul>
<p>因此, 尽量有良好的C语言编程习惯:</p>
<ul>
<li>尽量不使用全局变量.</li>
<li>使用全局变量尽量用<code>static</code>或者先赋初值.</li>
<li>外部全局变量尽量用<code>extern</code>.</li>
</ul>
<h4 id="符号解析算法"><a href="#符号解析算法" class="headerlink" title="符号解析算法"></a>符号解析算法</h4>
<p>定义三个集合<svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="7.349ex" height="1.984ex" role="img" focusable="false" viewbox="0 -683 3248.3 877" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"/><path id="MJX-1-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"/><path id="MJX-1-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/><path id="MJX-1-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D438" xlink:href="#MJX-1-TEX-I-1D438"/></g><g data-mml-node="mo" transform="translate(764,0)"><use data-c="2C" xlink:href="#MJX-1-TEX-N-2C"/></g><g data-mml-node="mi" transform="translate(1208.7,0)"><use data-c="1D448" xlink:href="#MJX-1-TEX-I-1D448"/></g><g data-mml-node="mo" transform="translate(1975.7,0)"><use data-c="2C" xlink:href="#MJX-1-TEX-N-2C"/></g><g data-mml-node="mi" transform="translate(2420.3,0)"><use data-c="1D437" xlink:href="#MJX-1-TEX-I-1D437"/></g></g></g></svg>:</p>
<ul>
<li><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.729ex" height="1.538ex" role="img" focusable="false" viewbox="0 -680 764 680" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-TEX-I-1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D438" xlink:href="#MJX-2-TEX-I-1D438"/></g></g></g></svg>: 生成最终ELF文件的所有目标文件的集合.</li>
<li><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-3-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-3-TEX-I-1D448"/></g></g></g></svg>: 所有没找到定义的符号集合.</li>
<li><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.873ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 828 683" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-4-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-4-TEX-I-1D437"/></g></g></g></svg>: 目前为止所有找到定义的符号的集合.</li>
</ul>
<p>按顺序扫描输入的所有文件<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-5-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-5-TEX-I-1D453"/></g></g></g></svg>:</p>
<ul>
<li>如果<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-6-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-6-TEX-I-1D453"/></g></g></g></svg>是可重定位目标文件, 那么就把<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-7-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-7-TEX-I-1D453"/></g></g></g></svg>放到<svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.729ex" height="1.538ex" role="img" focusable="false" viewbox="0 -680 764 680" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-8-TEX-I-1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D438" xlink:href="#MJX-8-TEX-I-1D438"/></g></g></g></svg>中, 然后根据对应符号修改<svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-9-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-9-TEX-I-1D448"/></g></g></g></svg>和<svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.873ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 828 683" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-10-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-10-TEX-I-1D437"/></g></g></g></svg>.</li>
<li>如果<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-11-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-11-TEX-I-1D453"/></g></g></g></svg>是库文件, 链接器根据<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-12-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-12-TEX-I-1D453"/></g></g></g></svg>中定义的符号, 修改集合<svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-13-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-13-TEX-I-1D448"/></g></g></g></svg>和<svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.873ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 828 683" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-14-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-14-TEX-I-1D437"/></g></g></g></svg>, 如果<svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-15-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-15-TEX-I-1D448"/></g></g></g></svg>中存在<svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-16-TEX-I-1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D453" xlink:href="#MJX-16-TEX-I-1D453"/></g></g></g></svg>中定义的符号, 就把它从<svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-17-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-17-TEX-I-1D448"/></g></g></g></svg>中取出放到<svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.873ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 828 683" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-18-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-18-TEX-I-1D437"/></g></g></g></svg>.</li>
<li>如果处理过程中, 向<svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.873ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 828 683" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-19-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-19-TEX-I-1D437"/></g></g></g></svg>中加入了一个已经存在的强符号/扫描完之后, <svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.735ex" height="1.595ex" role="img" focusable="false" viewbox="0 -683 767 705" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-20-TEX-I-1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D448" xlink:href="#MJX-20-TEX-I-1D448"/></g></g></g></svg>非空, 那么链接器就会报错.</li>
</ul>
<p>因此, 在链接过程中, 静态库文件一般位于可重定位目标文件顺序之后, 并且静态库文件之间也有顺序. 假设<code>libx.a</code>调用了<code>libz.a</code>的函数, 那么文件顺序应该是<code>libx.a libz.a</code>.</p>
<h3 id="静态链接和动态链接"><a href="#静态链接和动态链接" class="headerlink" title="静态链接和动态链接"></a>静态链接和动态链接</h3>
<ul>
<li>
<p>静态链接: 可执行目标文件与静态链接库<code>*.a</code>先链接成ELF文件, 运行的时候就不用再链接了.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 生成静态链接库</span><br>ar rcs &lt;静态库名称&gt;.a myproc1.o myproc2.o ...<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>动态链接: 先生成ELF文件, 然后运行的时候再和动态链接库<code>*.so</code>链接.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 生成动态链接库</span><br>gcc -shared -fPIC -o mylib.so myproc1.c myproc2.c<br></code></pre></td></tr></table></figure>
<ul>
<li><code>-shared</code>表示生成<code>.so</code>文件.</li>
<li><code>-fPIC</code>表示生成位置无关(Position Independent Code)的代码.</li>
</ul>
</li>
</ul>
<h3 id="链接地址、加载地址、运行地址"><a href="#链接地址、加载地址、运行地址" class="headerlink" title="链接地址、加载地址、运行地址"></a>链接地址、加载地址、运行地址</h3>
<p>首先需要介绍“位置相关代码”和“位置无关代码”.</p>
<ul>
<li>位置无关代码: 例如某些汇编指令里面, 用的是<code>pc</code>相对寻址, 没有把地址写死, 那这种指令就是位置无关代码.</li>
<li>位置相关代码: 某些指令把地址写死了, 那这种指令就是位置相关代码.</li>
</ul>
<p>链接地址其实就是在链接脚本中提供的一个地址值, 加载地址是代码实际加载位置的地址, 运行地址是这段代码在运行时的地址 (可能是物理地址/也可能是虚拟地址).</p>
<h4 id="链接地址和加载地址不一样"><a href="#链接地址和加载地址不一样" class="headerlink" title="链接地址和加载地址不一样"></a>链接地址和加载地址不一样</h4>
<p>观察如下链接脚本, 假设MMU未使能 (运行地址和链接地址相等)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">SECTIONS<br>&#123;<br>  .text <span class="hljs-number">0x1000</span> : &#123; *(.text); _etext = .; &#125;<br>  .mdata <span class="hljs-number">0x2000</span> :<br>  	<span class="hljs-comment">// AT用于指定加载地址</span><br>    AT &#123; <span class="hljs-built_in">ADDR</span> (.text) + <span class="hljs-built_in">SIZEOF</span>(.text) &#125;<br>  	&#123;_data = .; *(.data); _edata = .; &#125;<br>  .bss <span class="hljs-number">0x3000</span> :<br>  	&#123;_bstart = .; *(.bss) *(COMMON); _bend = .; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>此时, 对于<code>.mdata</code>段来说, 链接地址是<code>0x2000</code>开始, 但是加载地址是<code>ADDR(.text) + SIZEOF(.text)</code>, 也就是<code>.text</code>末尾的位置, 如下图所示:</p>
<p><img src="/2024/03/22/modern_cpp/lma.png" alt="内存布局"></p>
<p>此时, <code>.mdata</code>段一开始就在加载地址对应的内存中了, 一般是在ROM中, 需要搬到RAM中(也就是链接地址/运行地址对应处), 可以用如下代码:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span>* _etext, _data, _edata, _bstart, _bend;<br><br><span class="hljs-type">char</span> *src = _etext;<br><span class="hljs-type">char</span> *dst = _data;<br><br><span class="hljs-comment">/* 把加载地址区的东西搬到链接地址区 */</span><br><span class="hljs-keyword">while</span> (dst &lt; _edata)<br>  *dst ++ = *src ++;<br></code></pre></td></tr></table></figure>
<h4 id="链接地址和运行地址不相同"><a href="#链接地址和运行地址不相同" class="headerlink" title="链接地址和运行地址不相同"></a>链接地址和运行地址不相同</h4>
<p>观察如下链接脚本, 假设MMU使能</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">SECTIONS<br>&#123;<br>		. = 0xFFFF000000000000,<br>		_text_boot = .;<br>		.text_boot : &#123; *(.text.boot) &#125;<br>		_etext_boot = .;<br>		<br>		. = ALIGN(8);<br>		_text = .;<br>		.text :<br>		&#123;<br>			*(.text)<br>		&#125;<br>		. = ALIGN(8);<br>		_etext = .;<br>		...<br>&#125;<br></code></pre></td></tr></table></figure>
<p>此时链接地址是<code>0xFFFF000000000000</code>, 加载地址是由CPU决定, 假设是<code>0x80200000</code>.</p>
<p>首先加载地址等于运行地址, 都是在<code>0x80200000</code>上, 之后运行初始化代码, 初始化代码会初始化MMU, MMU会把CPU的运行地址重定位到链接地址处, 此时运行地址就等于链接地址了.</p>
<h4 id="固件程序的重定位和内核重定位"><a href="#固件程序的重定位和内核重定位" class="headerlink" title="固件程序的重定位和内核重定位"></a>固件程序的重定位和内核重定位</h4>
<ul>
<li>
<p>对于固件程序来说, 加载地址和链接地址不相同</p>
<ul>
<li>
<p>固件程序的加载地址在ROM中, 但是链接地址在RAM中, 固件程序首先执行位置无关代码, 将搬运内核的那部分代码从ROM搬到RAM中, 然后用位置有关代码跳转到RAM中继续执行.</p>
</li>
<li>
<p>跳转到RAM后, 继续执行的代码会把内核ELF文件搬运到RAM中, 然后跳转到内核ELF文件的entry point.</p>
</li>
<li>
<p>这个过程叫做固件重定位, RISC-V里由OpenSBI完成.</p>
</li>
</ul>
</li>
<li>
<p>对于内核程序来说, 一开始运行地址和链接地址不相同</p>
</li>
<li>
<p>内核可执行文件链接脚本里, 链接地址一般是虚拟地址, 进入到entry point的之后需要配置MMU, 将当前运行地址映射到内核的虚拟地址空间 (链接地址).</p>
<ul>
<li>这个过程叫内核重定位, 在Linux源码里实现.</li>
</ul>
</li>
</ul>
<h3 id="链接重定位与松弛优化"><a href="#链接重定位与松弛优化" class="headerlink" title="链接重定位与松弛优化"></a>链接重定位与松弛优化</h3>
<p>首先, 可重定位目标文件的符号首地址都是<code>0x0</code>, 但是这个可重定位目标文件中包含了重定位的信息, 一般存储在某一个例如<code>.rela.text</code>段中, 使用<code>readelf -a</code>可以查看到这个段.</p>
<p><img src="/2024/03/22/modern_cpp/readelf.png" alt="重定位段"></p>
<p>这些信息叫做目标文件的可重定位表(relocation table), 这个<code>.rela.text</code>就是重定位段.</p>
<p>RISC-V常见的重定位类型有如下几种:</p>
<ul>
<li><code>R_RISCV_CALL</code>: 用于处理函数调用中的寻址.</li>
<li><code>R_RISCV_RELEX</code>: 表示这里可能会进行松弛优化.</li>
<li><code>R_RISCV_PCREL_HI20</code>: 用于处理pc相对寻址指令的高20位.</li>
<li><code>R_RISCV_PCREL_LO12_I</code>: 用于处理加载指令的pc相对寻址的低12位.</li>
<li><code>R_RISCV_PCREL_LO12_S</code>: 用于处理存储指令的pc相对寻址的低12位.</li>
<li><code>R_RISCV_HI20</code>: 用于处理绝对寻址的高20位.</li>
<li><code>R_RISCV_LO12_I/R_RISCV_LO12_S</code>: 用于处理加载/存储的绝对寻址的低12位.</li>
</ul>
<h4 id="松弛优化"><a href="#松弛优化" class="headerlink" title="松弛优化"></a>松弛优化</h4>
<h5 id="对函数调用的松弛优化"><a href="#对函数调用的松弛优化" class="headerlink" title="对函数调用的松弛优化"></a>对函数调用的松弛优化</h5>
<p>函数调用<code>call func</code>一般会变成如下两条指令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly">auipc ra, 0<br>jalr  ra, 0(ra)<br></code></pre></td></tr></table></figure>
<p>其中<code>0</code>表示需要重定位的地方.</p>
<p>这两条指令的意思是, 首先让<code>ra</code>等于当前指令<code>pc</code>加上一个20位立即数<code>imm &lt;&lt; 12</code>, 然后用<code>jalr</code>指令, 首先将当前<code>pc+4</code>保存到<code>ra</code>中, 然后跳转到<code>ra</code>加上一个12位立即数对应的地址上.</p>
<p>也就是说, <code>call</code>指令能够跳转到距离当前<code>pc</code>32位有符号数的区间内, 如果知道了<code>func</code>地址与函数调用指令<code>pc</code>的差, 我就可以填入重定位的地方.</p>
<p>但是RISC-V还有一个短跳转指令叫做<code>jal rd, offset</code>, 表示先将<code>rd &lt;= pc + 4</code>, 然后跳转到<code>pc + offset</code>对应地址上, 其中<code>offset</code>有21位.</p>
<p>如果最终的<code>func</code>的地址距离<code>auipc</code>指令/<code>jalr</code>指令距离在21位有符号数的范围内, 那么就可以采用松弛优化, 将这两条指令直接用一个<code>jal</code>指令替换.</p>
<h5 id="对全局符号索引的松弛优化"><a href="#对全局符号索引的松弛优化" class="headerlink" title="对全局符号索引的松弛优化"></a>对全局符号索引的松弛优化</h5>
<p>使用绝对寻址/PC相对寻址访问一个符号的时候, 经常需要用下面两条指令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs assembly"># 绝对寻址<br>auipc a0, symbol地址的高20位<br>addi  a0, a0, symbol地址的低12位<br><br># 相对寻址, 数值A就是symbol和pc的差值, 可以索引pc +- 2GB的范围<br>auipc a0, A的高20位<br>addi  a0, A的低20位<br></code></pre></td></tr></table></figure>
<p>此时, 可以采用一个trick, 首先将<code>gp</code>寄存器的值设置到数据段<code>.sdata</code>(<code>.sdata</code>可以放置经常用的数据, 专门用来进行链接器松弛优化), 然后如果符号地址在<code>gp</code>寄存器上下2KB的范围, 那么就可以用一条指令<code>addi, a0, gp, offset</code>进行.</p>
<p>为什么范围设置成上下2KB? 因为2KB是<code>lw, addi</code>等指令支持的最大寻址范围, 就是12位有符号数的寻址范围.</p>
<h5 id="gcc中的松弛优化"><a href="#gcc中的松弛优化" class="headerlink" title="gcc中的松弛优化"></a>gcc中的松弛优化</h5>
<p>gcc选项<code>-mrelax</code>使能链接器松弛优化, <code>-mno-relax</code>关闭松弛优化.</p>
<h2><code>inline</code></h2>
<ul>
<li>
<p><code>inline</code>的作用: 在编译时, 将<code>inline</code>函数体直接替换到调用处, 而不是创建栈帧.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">call_function</span><span class="hljs-params">()</span> </span>&#123;<br>  cout &lt;&lt; <span class="hljs-string">&quot;niubi&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-built_in">call_function</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>优点:</p>
<ul>
<li><code>inline</code>适用于体积较小的函数, 可以提高可读性.</li>
<li>可以减少小函数创建/销毁栈帧的开销.</li>
</ul>
</li>
<li>
<p>缺点:</p>
<ul>
<li>二进制文件体积较大 (每个调用都要重复复制代码).</li>
<li>对I-Cache的利用率较低 (同一个I-Cache很有可能)</li>
<li>调试时, 调用栈可能过于复杂.</li>
</ul>
</li>
</ul>
<h2><code>struct</code></h2>
<ul>
<li>
<p>定义结构体:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Student</span> &#123;<br>  <br>  string name;<br>  <span class="hljs-type">int</span> age;<br>  <br>&#125; Student;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>例化结构体:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> *stu = <span class="hljs-keyword">new</span> Student &#123;<br>  <span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;haha&quot;</span>),<br>  <span class="hljs-number">10</span><br>&#125;;<br><span class="hljs-comment">//...</span><br><span class="hljs-built_in">free</span>(stu);<br></code></pre></td></tr></table></figure>
<ul>
<li>注意, 由于C++本身的特性, 这里参数名称和值没法对应, 需要用IDE的inlay hints.</li>
</ul>
</li>
<li>
<p>使用结构体变量:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">cout &lt;&lt; stu-&gt;name &lt;&lt; endl;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>结构体字段的权限:</p>
<ul>
<li>继承访问权: <code>public</code>.</li>
<li>外界访问权: <code>public</code>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>C语言的<code>struct</code>和C++的<code>struct</code>区别:</p>
</blockquote>
<ol>
<li>C++中的<code>struct</code>可以包含成员函数.</li>
<li>C++中的<code>struct</code>支持继承.</li>
<li>C++中的<code>struct</code>支持多态.</li>
</ol>
<h2><code>class</code></h2>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3>
<ul>
<li>
<p>定义类成员变量/成员函数:</p>
<ul>
<li>
<p>在<code>.hpp</code>文件中定义类:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br><span class="hljs-keyword">public</span>:<br>  string name;<br>  <span class="hljs-type">int</span> age;<br><br>  <span class="hljs-comment">// 构造函数</span><br>  <span class="hljs-built_in">Student</span>(string name, <span class="hljs-type">int</span> age): <span class="hljs-built_in">name</span>(std::<span class="hljs-built_in">move</span>(name)), <span class="hljs-built_in">age</span>(age) &#123;&#125;;<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>在<code>.cpp</code>文件中实现类中的成员函数:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Student::print</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>  cout &lt;&lt; <span class="hljs-keyword">this</span>-&gt;name &lt;&lt; endl;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p><font color="red">注意: 成员函数分为两类:</font></p>
<ul>
<li>不修改成员变量: 在函数后面加上<code>const</code>, 例如: <code>void print() const;</code>
<ul>
<li>在<code>const</code>修饰的函数体内部, <code>this</code>指针是常量指针.</li>
</ul>
</li>
<li>修改成员变量: 不用加<code>const</code>.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>创建类的对象:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> *stu = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Student</span>(<span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;haha&quot;</span>), <span class="hljs-number">10</span>);<br><br><span class="hljs-built_in">free</span>(stu);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>使用类的成员变量/函数:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">cout &lt;&lt; stu-&gt;name &lt;&lt; endl;<br>stu-&gt;<span class="hljs-built_in">print</span>();<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="成员权限"><a href="#成员权限" class="headerlink" title="成员权限"></a>成员权限</h3>
<ul>
<li>C++中成员变量/成员函数的三种权限:
<ul>
<li><code>private</code>: 类内成员函数可访问, 子类, 类外不可访问.</li>
<li><code>protected</code>: 类内成员函数, 子类可访问, 类外不可访问.</li>
<li><code>public</code>: 类内成员函数, 子类, 类外都可访问.</li>
<li>注意: 友元类可以无视权限, 直接访问到成员变量/函数.</li>
</ul>
</li>
</ul>
<h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3>
<ul>
<li>
<p>C++中, 如果提供了有参数的构造函数, 则不提供默认构造函数, 如果非要提供, 需要用<code>default</code>关键字:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>  <span class="hljs-keyword">public</span>:<br>  	<span class="hljs-built_in">Student</span>();<br>  	<span class="hljs-built_in">Student</span>(string name, <span class="hljs-type">int</span> age): <span class="hljs-built_in">name</span>(std::<span class="hljs-built_in">move</span>(name)), <span class="hljs-built_in">age</span>(age) &#123;&#125;;<br>&#125;<br><br>Student::<span class="hljs-built_in">Student</span>() = <span class="hljs-keyword">default</span>;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>C++的类中存在<strong>拷贝构造函数</strong>(copy constructor), 签名如下:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">Student</span>(<span class="hljs-type">const</span> Student &amp;stu);<br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>当需要对C++的非基本类型进行拷贝时, 就会自动调用拷贝构造函数.</p>
</li>
<li>
<p>如果没有显式重载拷贝构造函数, 编译器会提供默认实现, 递归调用非静态的成员变量.</p>
</li>
<li>
<p><strong>调用拷贝构造函数的场景:</strong></p>
<ul>
<li>函数参数值传递: 因为要把其他地方存储的对象调用拷贝构造, 放到栈上.</li>
<li>函数返回值: 同理.</li>
<li><code>Student stu(stu2);</code></li>
<li><code>Student stu = stu2;</code>这种赋值操作, <strong>注意, <code>stu = stu2</code>是调用的运算符</strong><code>=</code>.</li>
</ul>
</li>
<li>
<p>一般来说 拷贝构造都是比较慢的一个操作, 需要在程序中尽量避免拷贝构造.</p>
</li>
<li>
<p>C++类中的运算符<code>=</code>的签名为:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">Student &amp;<span class="hljs-keyword">operator</span>=(Student &amp;stu);<br></code></pre></td></tr></table></figure>
<ul>
<li><code>=</code>的默认实现和拷贝构造函数一致.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4><code>explicit</code></h4>
<ul>
<li>
<p>场景: 如果构造函数只有一个参数, 那么会有如下问题:</p>
<ul>
<li>
<p>假设有一个类和一个函数</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Student</span>(<span class="hljs-type">int</span> a) &#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Student stu)</span> </span>&#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>那么如果构造函数前面没有用<code>explicit</code>, 那么以下语句可以通过编译:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> a = <span class="hljs-number">1</span>;<br><span class="hljs-built_in">f</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>此时, <code>a</code>被隐式转换为<code>Student</code>, 但是这种行为一般不允许. 加上<code>explicit</code>即可:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Student</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> </span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(Student stu)</span> </span>&#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>因此, 如果类中构造函数只有一个参数, 前面都需要加上<code>explicit</code></p>
</li>
</ul>
<h3 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h3>
<ul>
<li>
<p>析构函数: 当对类的对象调用<code>delete</code>之前, 会首先调用析构函数:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>  <br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">public</span>:<br>  	<span class="hljs-type">char</span> name[<span class="hljs-number">4</span>];<br>  <br>  	~<span class="hljs-built_in">Student</span>() &#123;<br>      <span class="hljs-keyword">delete</span> [] name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>使用场景: 如果类的成员变量是动态内存申请得到的, 那么就需要在析构函数中手动<code>delete</code>.</li>
</ul>
</li>
</ul>
<h3 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h3>
<ul>
<li>
<p>重载的模板如下:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>  <br>  <span class="hljs-keyword">public</span>:<br>  	string name;<br>  	<span class="hljs-type">int</span> age;<br>  	<br>  	<span class="hljs-comment">// 重载+</span><br>  	Student <span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> Student &amp;stu);<br>  	Student <span class="hljs-keyword">operator</span>+(<span class="hljs-type">int</span> age);<br>  	<span class="hljs-comment">// 为了实现交换律, 需要用友元函数重载</span><br>  	<span class="hljs-keyword">friend</span> Student <span class="hljs-keyword">operator</span>+(<span class="hljs-type">int</span> age, <span class="hljs-type">const</span> Student &amp;stu);<br>  <br>  	<span class="hljs-comment">// 实现Java中的toString()</span><br>  	<span class="hljs-keyword">friend</span> ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(ostream &amp;out, <span class="hljs-type">const</span> Student &amp;stu);<br>&#125;;<br><br><span class="hljs-comment">// 在.cpp中实现</span><br>Student Student::<span class="hljs-keyword">operator</span>+(<span class="hljs-type">const</span> Student &amp;stu) &#123;<br>  Student stu;<br>  stu.name = <span class="hljs-keyword">this</span>-&gt;name;<br>  stu.age = <span class="hljs-keyword">this</span>-&gt;age + stu-&gt;age;<br>  <span class="hljs-keyword">return</span> stu;<br>&#125;<br><br>Student Student::<span class="hljs-keyword">operator</span>+(<span class="hljs-type">int</span> age) &#123;<br><br>&#125;<br><br><span class="hljs-comment">// 友元函数</span><br><span class="hljs-keyword">friend</span> Student <span class="hljs-keyword">operator</span>+(<span class="hljs-type">int</span> age, <span class="hljs-type">const</span> Student &amp;stu) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// toString</span><br><span class="hljs-keyword">friend</span> ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(ostream &amp; out, <span class="hljs-type">const</span> Student &amp;stu) &#123;<br>  out &lt;&lt; <span class="hljs-string">&quot;这里自己格式化, 可以访问stu的所有变量&quot;</span>;<br>  <span class="hljs-keyword">return</span> out;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3>
<ul>
<li>
<p>继承的使用方式:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>: <span class="hljs-keyword">public</span> People &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<ul>
<li>子类中访问父类的成员变量: <code>People::name</code>.</li>
<li>子类中调用父类成员方法: <code>People::print()</code>.</li>
<li>因为C++支持多继承, 所以需要指明是哪个父类.</li>
</ul>
</li>
<li>
<p>继承的行为:</p>
<ul>
<li>继承会根据继承方式, 以及父类中成员变量与成员函数的权限, 决定子类中有哪些成员变量和函数.</li>
<li>继承后, 子类的构造函数, 析构函数, 拷贝构造函数, 重载运算符及友元函数会和父类有所不同.
<ul>
<li>构造函数: 先调用父类构造函数, 再调用子类的.</li>
<li>析构函数: 先调用子类的析构函数, 再调用父类的.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>继承的方式:</p>
<ul>
<li>继承方式决定了父类中, 成员变量/函数的权限在子类中会变成什么样.</li>
<li>如果不写, 默认是<code>private</code>继承.</li>
<li><code>public</code>继承:
<ul>
<li>父类中是<code>public</code>, 子类中也是<code>public</code>.</li>
<li>父类中是<code>protected</code>, 子类中也是<code>protected</code>.</li>
</ul>
</li>
<li><code>protected</code>继承:
<ul>
<li>父类中是<code>public/protected</code>, 子类中都是<code>protected</code>.</li>
</ul>
</li>
<li><code>private</code>继承:
<ul>
<li>父类中是<code>public/protected</code>, 子类中都是<code>private</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="虚函数"><a href="#虚函数" class="headerlink" title="虚函数"></a>虚函数</h3>
<ul>
<li>
<p>虚函数出现的背景: 假设父类和子类都有<code>print</code>, 那么这里会调用哪个<code>print</code>?</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">People *stu = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Student</span>(<span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;haha&quot;</span>), <span class="hljs-number">3</span>);<br>stu-&gt;<span class="hljs-built_in">print</span>();<br></code></pre></td></tr></table></figure>
<ul>
<li>如果<code>print</code>不是虚函数, 那么会调用父类, 如果是虚函数, 那么会调用子类.</li>
</ul>
</li>
<li>
<p>虚函数使用: 在成员函数前面加<code>virtual</code>:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> &#123;<br>  <br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;haha&quot;</span> &lt;&lt; endl;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>注意: <strong>虚函数只能是类的成员函数</strong>, 不能是普通函数.</p>
</li>
<li>
<p>纯虚函数: 相当于接口, 子类必须实现, 父类不能创建对象.</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> &#123;<br><br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>  <br>&#125;;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>静态绑定与动态绑定:</p>
<ul>
<li>静态绑定: 编译时期, 决定每一个成员函数的函数体.</li>
<li>动态绑定: 编译时期不决定这个函数具体的函数体, 在运行时, 根据对象最小范围的类型决定调哪个函数体.</li>
<li>如果定义一个函数是虚函数, 那么这个函数具体是哪个会由动态绑定决定.</li>
</ul>
</li>
<li>
<p>虚函数的一些结论:</p>
<ul>
<li>如果父类中有一个成员函数是虚函数, 那么子类中继承过来的函数也是虚函数.</li>
<li>析构函数一定是虚函数.</li>
<li>构造函数一定不是虚函数, 因为虚函数只有你调用了构造函数创建完对象了, 才能决定.</li>
</ul>
</li>
</ul>
<h3 id="常见问题-2"><a href="#常见问题-2" class="headerlink" title="常见问题"></a>常见问题</h3>
<blockquote>
<p>C++中<code>struct</code>和<code>class</code>的区别?</p>
</blockquote>
<ul>
<li><code>struct</code>中成员变量/函数默认权限为<code>public</code>.</li>
<li><code>class</code>中成员变量/函数默认权限为<code>private</code>.</li>
</ul>
<blockquote>
<p>什么时候需要重载copy constructor?</p>
</blockquote>
<ul>
<li>当类的成员变量有指针的时候.</li>
<li>如果不重载, 指针变量会被拷贝, 导致两个对象共享同一份数据, 很可能会出现内存泄漏.</li>
</ul>
<blockquote>
<p>构造函数和析构函数中可以调用某个虚函数吗?</p>
</blockquote>
<ul>
<li>首先, 编译器不会报错.</li>
<li>其次, 这种做法是毫无意义的, 使用虚函数的目的, 是为了「多态」.
<ul>
<li>如果构造函数调用虚函数, 其实在构造函数确定时, 已经明确了类型 (父类肯定调完了, 子类还没调, 肯定是父类), 使用虚函数没有意义.</li>
<li>如果析构函数调用虚函数, 那么也明确了类型 (子类已经析构完了, 肯定是父类), 使用虚函数没有意义.</li>
</ul>
</li>
</ul>
<blockquote>
<p>类的析构函数中调用<code>delete this;</code>会出现什么情况:</p>
</blockquote>
<ul>
<li>无限递归, 因为<code>delete this;</code>就会先调用类的析构函数, 然后再析构指针, 然后释放指针内存.</li>
</ul>
<blockquote>
<p>什么是多态 (polymorphism)?</p>
</blockquote>
<ul>
<li>指为不同数据类型的实体提供统一的接口.</li>
</ul>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2>
<h2 id="RAII"><a href="#RAII" class="headerlink" title="RAII"></a>RAII</h2>
<ul>
<li>RAII的全称是Resource Acquisition is Initialization. 它是C++中资源管理的一些思想:
<ul>
<li>资源使用包括三个阶段: 获取资源, 使用资源, 释放资源.</li>
<li>释放资源很麻烦, 而且经常忘记, 需要有一种机制, 在资源不使用时, 自动释放.</li>
</ul>
</li>
</ul>
<h3 id="智能指针"><a href="#智能指针" class="headerlink" title="智能指针"></a>智能指针</h3>
<ul>
<li>
<p>智能指针的使用:</p>
<ul>
<li>
<p>智能指针需要<code>#include&lt;memory&gt;</code>, 在<code>std</code>下.</p>
</li>
<li>
<p>智能指针的类型声明:</p>
<ul>
<li><code>std::unique_ptr&lt;T&gt;</code>.</li>
<li><code>std::shared_ptr&lt;T&gt;</code>.</li>
</ul>
</li>
<li>
<p>创建智能指针:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">std::shared_ptr&lt;Student&gt; stu = std::<span class="hljs-built_in">make_shared</span>&lt;Student&gt;(<span class="hljs-comment">/*构造函数参数*/</span>);<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>对智能指针的理解:</p>
<ul>
<li>在C++中. 很多默认行为都是“拷贝”, 而对裸指针进行拷贝, 等价于对所有权进行共享, 及其容易发生内存泄漏.</li>
<li>因此, 对裸指针进行封装后, 对“拷贝”这一行为有了约束:
<ul>
<li><code>unique_ptr</code>在编译时期, 能够保证同一时刻, 只有一个智能指针拥有内存所有权, 如果要转移所有权, 需要手动调用<code>std::move</code>.</li>
<li><code>shared_ptr</code>是一种共享所有权的机制, 因为有很多数据结构需要共享, 比如互斥锁等.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="常见问题-3"><a href="#常见问题-3" class="headerlink" title="常见问题"></a>常见问题</h3>
<blockquote>
<p><code>shared_ptr</code>中的引用计数为什么是<code>int*</code>, 而不是<code>int</code>或者是<code>static int</code>?</p>
</blockquote>
<ul>
<li>
<p>使用<code>int*</code>无法保证所有<code>shared_ptr</code>共享同一个引用计数 .</p>
</li>
<li>
<p><code>static int</code>在如下情况有错误:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">std::shared_ptr&lt;T&gt; a;<br>std::shared_ptr&lt;T&gt; b;<br>std::shared_ptr&lt;T&gt; c;<br><span class="hljs-comment">// 没有一个对象, 但是引用计数是3</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>使用智能指针还可能出现什么问题?</p>
</blockquote>
<ul>
<li>如果从裸指针同时创建两个独立的<code>shared_ptr</code>, 那么会导致同一块内存释放两次.</li>
<li>如果两个<code>shared_ptr</code>互相引用, 那么会导致引用计数永远无法清0, 内存无法释放.</li>
</ul>
<h2 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h2>
<h3><code>Vector</code></h3>
<h2 id="左值与右值"><a href="#左值与右值" class="headerlink" title="左值与右值"></a>左值与右值</h2>
<ul>
<li><strong>左值</strong>: 可以理解成是一个<code>Named Object</code>, 可以取地址.
<ul>
<li>例如变量名.</li>
</ul>
</li>
<li><strong>右值</strong>: 可以理解为<code>Anonymous Object</code>, 是临时产生的值, 不可以取地址.
<ul>
<li>类型的字面值常量: <code>10, 20..</code></li>
<li>表达式: <code>x + y</code></li>
<li>传值返回的函数 (不是传引用): <code>min(a, b)</code>.</li>
<li>如果用<code>&amp;10, &amp;(x + y), 或者&amp;min(a, b)</code>会出现编译报错.</li>
</ul>
</li>
</ul>
<h3 id="左值-右值引用"><a href="#左值-右值引用" class="headerlink" title="左值/右值引用"></a>左值/右值引用</h3>
<ul>
<li>
<p>左值引用就是对左值取引用, 目的是<strong>避免对象拷贝</strong>:</p>
<ul>
<li><code>int &amp;a = b;</code></li>
</ul>
</li>
<li>
<p>右值引用是C++11后面的标准, 可以对右值取引用:</p>
<ul>
<li>
<p>格式是:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> &amp;&amp;a = <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<ul>
<li>注意, 这里的<code>a</code>是<code>int &amp;</code>类型, 但是<code>std::move(a)</code>是<code>int &amp;&amp;</code>类型, <code>1</code>也是<code>int &amp;&amp;</code>类型.</li>
<li><code>std::move</code>位于<code>&lt;utility&gt;</code>中, 可以将一个左值/左值引用转换为右值引用.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>一些规律:</p>
<ul>
<li><code>const</code>左值引用可以引用右值:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;a = <span class="hljs-number">1</span>; <span class="hljs-comment">//通过</span><br><span class="hljs-type">int</span> &amp;a = <span class="hljs-number">1</span>; <span class="hljs-comment">//编译错误</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>为什么会有右值引用?</p>
</blockquote>
<ul>
<li>假设要设计一个<code>String</code>类, 代码如下:</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">String</span> &#123;<br><br><span class="hljs-keyword">private</span>:<br>	<span class="hljs-type">char</span> * data;<br>	<span class="hljs-type">size_t</span> size;<br><br><span class="hljs-keyword">public</span>:<br>	<span class="hljs-built_in">String</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *str) &#123;<br>		<span class="hljs-keyword">this</span>-&gt;size = <span class="hljs-built_in">strlen</span>(str);<br>		<span class="hljs-keyword">this</span>-&gt;data = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-keyword">this</span>-&gt;size];<br>		<span class="hljs-built_in">strcpy</span>(<span class="hljs-keyword">this</span>-&gt;data, str);<br>	&#125;<br>  <br>	~<span class="hljs-built_in">String</span>() &#123;<br>		<span class="hljs-keyword">delete</span> [] <span class="hljs-keyword">this</span>-&gt;data;<br>	&#125;<br>  <br>	String&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> String&amp; str) &#123;<br>		<span class="hljs-keyword">delete</span> [] <span class="hljs-keyword">this</span>-&gt;data;<br>		<span class="hljs-keyword">this</span>-&gt;size = str.size;<br>		<span class="hljs-keyword">this</span>-&gt;data = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-keyword">this</span>-&gt;size];<br>		<span class="hljs-built_in">strcpy</span>(<span class="hljs-keyword">this</span>-&gt;data, str.data);<br>		<span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>	&#125;<br>  <br>&#125;;<br><br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>那么在使用时, 这个类会出现问题, 例如如下代码:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <br>  <span class="hljs-function">String <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-string">&quot;haha&quot;</span>)</span></span>;<br>  a = <span class="hljs-built_in">String</span>(<span class="hljs-string">&quot;heihei&quot;</span>);<br>  <br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>
<p><code>a = String("heihei")</code>这行代码, 需要调用<code>=</code>运算符:</p>
<ul>
<li><code>String("heihei")</code>是一个右值, 系统会创建一个<code>String</code>类型的临时变量<code>temp</code>接收.</li>
<li>接收后, 临时变量的左值引用会传到<code>=</code>函数中, 然后按照一定逻辑对临时变量进行深拷贝.</li>
<li>然后调用析构函数销毁临时变量.</li>
<li><font color="red">**这里最大的问题是, 我有了临时变量我还要拷贝一次, 就不能把系统给我的临时变量直接当作最终结果返回吗?&nbsp;**</font>
<ul>
<li>也就是说, 我们不再根据右值做拷贝, 而是把右值生命周期延长, 直接作为我返回的变量, 来避免深拷贝.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>解决方案就是: 新加一个<code>=</code>的重载, 参数是右值引用:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp">String &amp;<span class="hljs-keyword">operator</span>=(String &amp;&amp; str) &#123;<br>  <span class="hljs-keyword">delete</span> [] <span class="hljs-keyword">this</span>-&gt;data;<br>  <br>  <span class="hljs-comment">// 直接拿右值中的值</span><br>  <span class="hljs-keyword">this</span>-&gt;data = str.data;<br>  <span class="hljs-keyword">this</span>-&gt;size = str.size;<br>  <br>  <span class="hljs-comment">// 防止右值析构函数把str.data释放了</span><br>  str.data = <span class="hljs-literal">nullptr</span>;<br>  str.size = <span class="hljs-number">0</span>;<br>  <br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="移动构造函数"><a href="#移动构造函数" class="headerlink" title="移动构造函数"></a>移动构造函数</h3>
<ul>
<li>
<p>和上面的<code>=</code>一样, 构造函数也有接收右值的形态, 这种构造函数叫做<strong>移动构造函数</strong>:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">String</span>(String &amp;&amp; str) &#123;<br>  <span class="hljs-keyword">this</span>-&gt;data = str.data;<br>  <span class="hljs-keyword">this</span>-&gt;size = str.size;<br>  <br>  str.data = <span class="hljs-literal">nullptr</span>;<br>  str.size = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>因此, 如果函数参数为<code>const T &amp;</code>, 默认进行拷贝, 如果是<code>T&amp;&amp;</code>, 默认进行移动.</p>
</li>
</ul>
<h3 id="引用折叠-万能引用-完美转发"><a href="#引用折叠-万能引用-完美转发" class="headerlink" title="引用折叠/万能引用/完美转发"></a>引用折叠/万能引用/完美转发</h3>
<ul>
<li>
<p>引用折叠一般发生在模板参数<code>T</code>的推导上, 规则如下:</p>
<ul>
<li><code>T&amp;</code>左值引用, 再取一次左值引用<code>&amp;</code>, 还是<code>T&amp;</code>.</li>
<li><code>T&amp;</code>左值引用, 再去一次右值引用<code>&amp;&amp;</code>, 还是<code>T&amp;</code>.</li>
<li><strong><code>T&amp;&amp;</code>右值引用, 再取一次左值引用<code>&amp;</code>, 是<code>T&amp;</code>.</strong></li>
<li><code>T&amp;&amp;</code>右值引用, 再去一次右值引用<code>&amp;&amp;</code>, 还是<code>T&amp;&amp;</code>.</li>
</ul>
</li>
<li>
<p>因此, 根据引用折叠的规律, 在函数模板中, <code>T &amp;&amp;</code>类型叫做万能引用.</p>
<ul>
<li><code>T &amp;&amp;</code>接收左值, 会被推导为左值引用.</li>
<li>接收右值, 需要配合完美转发, 才会被推导为右值引用.</li>
</ul>
</li>
<li>
<p>例如如下代码:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp; t)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp; t)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;&amp; t)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(T &amp;&amp;t)</span> </span>&#123;<br>  <span class="hljs-comment">// std::forward叫做完美转发</span><br>  <span class="hljs-built_in">func</span>(std::forward&lt;T&gt;(t));<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>使用万能引用和完美转发, 可以根据引用的具体类型来调用不同的函数.</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么需要完美转发?</p>
</blockquote>
<ul>
<li>
<p>如果没有完美转发, 代码如下:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp; t)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp; t)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;&amp; t)</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(T &amp;&amp;t)</span> </span>&#123;<br>  <span class="hljs-comment">// std::forward叫做完美转发</span><br>  <span class="hljs-built_in">func</span>(t);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>此时, 如果调用函数:</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <br>  <span class="hljs-type">int</span> a = <span class="hljs-number">1</span>;<br>  <span class="hljs-type">int</span> &amp;b = a;<br>  <span class="hljs-type">const</span> <span class="hljs-type">int</span> &amp;c = a;<br>  <br>  <span class="hljs-built_in">f</span>(b); <span class="hljs-comment">// T推导为int &amp;</span><br>  <span class="hljs-built_in">f</span>(c); <span class="hljs-comment">// T推导为const int &amp;</span><br>  <br>  <span class="hljs-built_in">f</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// T推导为int &amp;</span><br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>注意, 调用<code>f(10)</code>之后, 本来预期调用<code>func(int &amp;&amp;t)</code>, 但是却会调用<code>func(int &amp;t)</code>, 这是因为: <code>t</code>的类型本身就是一个<code>T&amp;</code>.
<ul>
<li>因此, 为了解决这个矛盾, 就使用完美转发.</li>
<li>也就是说, <code>f(10)</code>中传递10, 只能让你到<code>f(T &amp;&amp; t)</code>这一层, 到了这里, 就失去了右值引用这个属性, 想要进一步保持, 可以用<code>std::forward</code> .</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><code>CMake</code></h2>
<h3><code>compile_commands</code></h3>
<ul>
<li>
<p><code>CMakeLists.txt</code>中添加这个可以生成<code>compile_commands.json</code>, 用来给IDE语法解析用.</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
</li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> 向阳而生, 喜欢聪明的人. </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©B1ueDrops
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
